# 動態最小資料量要求功能說明

## 📋 功能概述

本專案已改進最小資料量要求機制，從原本統一的1500根K線要求，改為根據不同時間框架動態計算的最小資料量要求。

## ⚙️ 配置選項

### 1. 動態最小資料量模式（預設啟用）
```python
use_dynamic_min_bars: bool = True  # 是否使用動態最小資料量計算
```

### 2. 各時間框架的最小天數要求
```python
min_days_per_timeframe: Dict[str, int] = {
    "1m": 30,    # 至少30天，捕捉短期波動模式
    "5m": 60,    # 至少60天，足夠的短期趨勢
    "15m": 90,   # 至少90天，中期趨勢分析
    "1h": 180,   # 至少180天，長期趨勢確認
    "4h": 365,   # 至少1年，完整年度週期
    "1d": 1095,  # 至少3年，多年度週期
    "1w": 3650   # 至少10年，長期市場週期
}
```

## 📊 各時間框架的實際資料量要求

| 時間框架 | 每根K線分鐘 | 最小天數 | 最小K線數 | 說明 |
|---------|-------------|----------|-----------|------|
| **1m** | 1分鐘 | 30天 | 43,200 | 短期波動模式 |
| **5m** | 5分鐘 | 60天 | 17,280 | 短期趨勢 |
| **15m** | 15分鐘 | 90天 | 8,640 | 中期趨勢 |
| **1h** | 60分鐘 | 180天 | 4,320 | 長期趨勢確認 |
| **4h** | 240分鐘 | 365天 | 2,190 | 年度週期 |
| **1d** | 1,440分鐘 | 1,095天 | 1,095 | 多年度週期 |
| **1w** | 10,080分鐘 | 3,650天 | 521 | 長期市場週期 |

## 🔄 與舊版本的比較

### 舊版本（固定要求）
- 所有時間框架統一要求：**1,500根K線**
- 問題：
  - 1m時間框架只需要2.7天資料
  - 4h時間框架需要657天資料
  - 1d時間框架需要4.1年資料

### 新版本（動態要求）
- 根據時間框架特性設定合理的最小天數
- 優點：
  - 高頻時間框架需要更多資料確保統計穩定性
  - 低頻時間框架可以接受較少資料量但需要更長時間跨度
  - 更符合實際分析需求

## 🛠️ 使用方法

### 1. 啟用動態模式（預設）
```python
cfg = CFG
cfg.use_dynamic_min_bars = True  # 預設已啟用
```

### 2. 使用固定模式（向後相容）
```python
cfg = CFG
cfg.use_dynamic_min_bars = False
cfg.n_min_bars_for_backtest = 1500  # 使用固定要求
```

### 3. 自訂最小天數要求
```python
cfg = CFG
cfg.min_days_per_timeframe = {
    "1m": 60,    # 自訂1m需要60天
    "1h": 365,   # 自訂1h需要1年
    # ... 其他時間框架
}
```

## 📈 實際應用建議

### 1. 短期分析（30-90天）
- 適合：1m, 5m, 15m時間框架
- 用途：短期策略測試、快速驗證

### 2. 中期分析（180-365天）
- 適合：1h, 4h時間框架
- 用途：策略優化、參數調整

### 3. 長期分析（1年+）
- 適合：4h, 1d, 1w時間框架
- 用途：策略穩定性驗證、長期表現評估

## 🧪 測試功能

運行測試腳本來查看各時間框架的資料量要求：

```bash
python test_dynamic_min_bars.py
```

輸出範例：
```
============================================================
動態最小資料量要求測試
============================================================
使用動態最小資料量計算: True

各時間框架的最小資料量要求：
--------------------------------------------------
時間框架     每根K線分鐘       最小天數       最小K線數        說明
--------------------------------------------------
1m       1.0          30         43200        短期波動模式
5m       5.0          60         17280        短期趨勢
15m      15.0         90         8640         中期趨勢
1h       60.0         180        4320         長期趨勢確認
4h       240.0        365        2190         年度週期
1d       1440.0       1095       1095         多年度週期
1w       10080.0      3650       521          長期市場週期
--------------------------------------------------
```

## ⚠️ 注意事項

1. **絕對最小值**：所有時間框架都確保至少有100根K線作為絕對最小值
2. **向後相容**：舊的固定模式仍然可用
3. **報告更新**：錯誤訊息和報告會顯示具體的時間框架要求
4. **效能影響**：動態計算對效能影響極小

## 🎯 優化效果

- **更合理的資料量要求**：避免過度或不足的資料量
- **更好的統計穩定性**：確保每個時間框架都有足夠的樣本
- **更清晰的錯誤訊息**：明確指出每個時間框架的具體要求
- **更靈活的配置**：可以根據需求自訂各時間框架的要求
